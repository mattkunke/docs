<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Deposit Security Committee manual | Lido Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://lidofinance.github.io/guides/deposit-security-manual"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deposit Security Committee manual | Lido Docs"><meta data-react-helmet="true" name="description" content="This instruction has been prepared for the participants of the Deposit Security Committee and describes the general points, the preparation steps to act as a guardian, and the details of the protection mechanism. The Deposit Security Committee is necessary to prevent the substitution of withdrawal credentials with frontrunning by node operators. Each member of the committee must perform several actions to ensure the security of deposits made by Lido. To participate in the validation, you will need to deploy a lido-council-daemon and prepare a private key for signing messages about the correctness of data or the need to stop deposits in case of attack."><meta data-react-helmet="true" property="og:description" content="This instruction has been prepared for the participants of the Deposit Security Committee and describes the general points, the preparation steps to act as a guardian, and the details of the protection mechanism. The Deposit Security Committee is necessary to prevent the substitution of withdrawal credentials with frontrunning by node operators. Each member of the committee must perform several actions to ensure the security of deposits made by Lido. To participate in the validation, you will need to deploy a lido-council-daemon and prepare a private key for signing messages about the correctness of data or the need to stop deposits in case of attack."><link data-react-helmet="true" rel="icon" href="/img/favicon-32x32.png"><link data-react-helmet="true" rel="canonical" href="https://lidofinance.github.io/guides/deposit-security-manual"><link data-react-helmet="true" rel="alternate" href="https://lidofinance.github.io/guides/deposit-security-manual" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://lidofinance.github.io/guides/deposit-security-manual" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f9d99c6c.css">
<link rel="preload" href="/assets/js/runtime~main.02182c53.js" as="script">
<link rel="preload" href="/assets/js/main.20b2d517.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Lido Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Lido Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lidofinance" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lido-dao">Lido DAO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/guides/steth-integration-guide">stETH/wstETH integration guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/guides/node-operator-manual">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/node-operator-manual">Node Operator Manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/oracle-operator-manual">Oracle Operator Manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/guides/deposit-security-manual">Deposit Security Committee manual</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/guides/tooling">Tooling</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/multisig-deployment">Multisig deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/protocol-levers">Protocol levers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/etherscan-voting">DAO voting with Etherscan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/easy-track-guide">Guide to Easy Track</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/address-ownership-guide">Verifying address ownership for Lido DAO ops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/multisig-signer-manual">Guide to being a signer at any Lido DAO multisigs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/checking-aragon-vote">Checking the evm script from Aragon vote</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/checking-gnosis-safe">How to verify the multisig is a Gnosis one</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/1inch-pool-rewards">How to claim 1inch stETH/LDO pool rewards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/early-staker-airdrop">How to claim Lido early stakers airdrop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/jumpgates">How to Bridge Tokens through Jumpgate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/verify-lido-v2-upgrade-manual">Lido V2 mainnet parameters</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/integrations/api">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/token-guides/steth-superuser-functions">Token guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/contracts/lido">Contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/security/bugbounty">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_TwRn" href="/deployed-contracts/">Deployed contracts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deployed contracts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deposit Security Committee manual</h1></header><p>This instruction has been prepared for the participants of the Deposit Security Committee and describes the general points, the preparation steps to act as a guardian, and the details of the protection mechanism. The Deposit Security Committee is necessary to prevent the substitution of withdrawal credentials with frontrunning by node operators. Each member of the committee must perform several actions to ensure the security of deposits made by Lido. To participate in the validation, you will need to deploy a <code>lido-council-daemon</code> and prepare a private key for signing messages about the correctness of data or the need to stop deposits in case of attack.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="tldr">TL;DR<a class="hash-link" href="#tldr" title="Direct link to heading">‚Äã</a></h2><p>Before running in the mainnet all steps should be done in the Goerli testnet.</p><ol><li>Prepare an EOA account for signing data with a private key on hand (not in hardware wallet). It will be a moderately sensitive hot private key. Use different accounts for testnet and mainnet.</li><li>Send the account address to Lido for submitting it to the smart contract. </li><li>Deploy and run <code>lido-council-daemon</code> with the private key from the EOA account. It would work in a dry-run mode until your address would be included in the smart contract.  </li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="detailed-description">Detailed description<a class="hash-link" href="#detailed-description" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-vulnerability">The vulnerability<a class="hash-link" href="#the-vulnerability" title="Direct link to heading">‚Äã</a></h3><p>There is the vulnerability allowing the malicious Node Operator to intercept the user funds on deposits to the Beacon chain in the Lido protocol. The vulnerability could only be exploited by the Node Operator front-running the <code>Lido.depositBufferedEther</code> transaction with direct deposit to the DepositContract of no less than 1 ETH with the same validator public key &amp; withdrawal credentials different from the Lido‚Äôs ones, effectively getting control over 32 ETH from Lido. To mitigate this, Lido contracts should be able to check that Node Operators‚Äô keys hadn‚Äôt been used for malicious pre-deposits.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-deposit-security-committee">The Deposit Security Committee<a class="hash-link" href="#the-deposit-security-committee" title="Direct link to heading">‚Äã</a></h3><p>We propose to establish the Deposit Security Committee dedicated to ensuring the safety of deposits on the Beacon chain:</p><ul><li>monitoring the history of deposits and the set of Lido keys available for the deposit, signing and disseminating messages allowing deposits;</li><li>signing the special message allowing anyone to pause deposits once the malicious Node Operator pre-deposits are detected.</li></ul><p>To make a deposit, we propose to collect a quorum of 2/3 of the signatures of the committee members. Members of the committee can collude with node operators and steal money by signing bad data that contains malicious pre-deposits. To mitigate this we propose to allow single committee member to stop deposits and also enforce space deposits in time (e.g. no more than 150 deposits with 150 blocks in between them), to provide single honest participant an ability to stop further deposits even if the supermajority colludes. The idea was outlined on research forum post as the option <a href="https://research.lido.fi/t/mitigations-for-deposit-front-running-vulnerability/1239#d-approving-deposit-contract-merkle-root-7" target="_blank" rel="noopener noreferrer"><b>d</b></a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="committee-membership">Committee membership<a class="hash-link" href="#committee-membership" title="Direct link to heading">‚Äã</a></h3><p>The first set of guardians is six node operators (Stakefish, Skillz, Chorus one, Blockscape, Staking facilities, P2P) and Lido dev team. In the future, we want to bring as many node operators as possible into the mix, so the expectation will be that while the 7 guardians start the rest of the node operators can also participate via testnet and gradually get pulled into mainnet. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="members-responsibilities">Members responsibilities<a class="hash-link" href="#members-responsibilities" title="Direct link to heading">‚Äã</a></h3><p>Each member must prepare an EOA account to sign the pair <code>(depositRoot, keysOpIndex)</code> with its private key. The addresses of the committee members will be added to the smart contract. Also, member has to run <code>DSC Daemon</code>that monitors the validators‚Äô public keys in the <code>DepositContract</code> and <code>NodeOperatorRegistry</code>. The daemon must have access to the committee member‚Äôs private key to be able to perform ECDSA signing.</p><p>The daemon constantly watches all updates in <code>DepositContract</code> and <code>NodeOperatorRegistry</code>:</p><ul><li>If the state is correct, it signes the current to_sign struct and emits it to an off-chain message queue.</li><li>If the state has malicious pre-deposits, it signs the ‚Äúsomething‚Äôs wrong‚Äù message at the current block, emits it to a message queue, and attempts to send pauseDeposits() tx.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="preparation-steps">Preparation steps<a class="hash-link" href="#preparation-steps" title="Direct link to heading">‚Äã</a></h2><p>Before running in the mainnet, all steps should be completed in the Goerli testnet.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="eoa-account">EOA account<a class="hash-link" href="#eoa-account" title="Direct link to heading">‚Äã</a></h3><p>It might be any EOA account under the member&#x27;s control. Send the address of its account to Lido for submitting it to the smart contract. Lido will provide some ETH to make stopping transactions if needed (shouldn&#x27;t ever be the case). Note, all actions, except sending the stop message, would be done off-chain.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="run-lido-council-daemon">Run lido-council-daemon<a class="hash-link" href="#run-lido-council-daemon" title="Direct link to heading">‚Äã</a></h3><p>To start the application, see the technical documentation in the project <a href="https://github.com/lidofinance/lido-council-daemon#table-of-contents" target="_blank" rel="noopener noreferrer">repository</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lidofinance/docs/blob/main/docs/guides/deposit-security-manual.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/guides/oracle-operator-manual"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Oracle Operator Manual</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/guides/tooling"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tooling Overview</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr" class="table-of-contents__link toc-highlight">TL;DR</a></li><li><a href="#detailed-description" class="table-of-contents__link toc-highlight">Detailed description</a><ul><li><a href="#the-vulnerability" class="table-of-contents__link toc-highlight">The vulnerability</a></li><li><a href="#the-deposit-security-committee" class="table-of-contents__link toc-highlight">The Deposit Security Committee</a></li><li><a href="#committee-membership" class="table-of-contents__link toc-highlight">Committee membership</a></li><li><a href="#members-responsibilities" class="table-of-contents__link toc-highlight">Members responsibilities</a></li></ul></li><li><a href="#preparation-steps" class="table-of-contents__link toc-highlight">Preparation steps</a><ul><li><a href="#eoa-account" class="table-of-contents__link toc-highlight">EOA account</a></li><li><a href="#run-lido-council-daemon" class="table-of-contents__link toc-highlight">Run lido-council-daemon</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.02182c53.js"></script>
<script src="/assets/js/main.20b2d517.js"></script>
</body>
</html>